<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · ModelWeights.jl</title><meta name="title" content="Getting started · ModelWeights.jl"/><meta property="og:title" content="Getting started · ModelWeights.jl"/><meta property="twitter:title" content="Getting started · ModelWeights.jl"/><meta name="description" content="Documentation for ModelWeights.jl."/><meta property="og:description" content="Documentation for ModelWeights.jl."/><meta property="twitter:description" content="Documentation for ModelWeights.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="ModelWeights.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ModelWeights.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../requirements/">Requirements</a></li><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#How-to-load-data"><span>How to load data</span></a></li><li><a class="tocitem" href="#How-to-compute-weights"><span>How to compute weights</span></a></li></ul></li><li><a class="tocitem" href="../weights/">Computing weights</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/climwip/">Climwip example from Brunner et al. (2020)</a></li><li><a class="tocitem" href="../examples/lgm/">Weights for models of lgm experiment</a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/awi-esc/ModelWeights" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/awi-esc/ModelWeights/blob/main/docs/src/getting-started.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h1><p>In the following, we explain how to load data and how to compute model weights.</p><h2 id="How-to-load-data"><a class="docs-heading-anchor" href="#How-to-load-data">How to load data</a><a id="How-to-load-data-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-load-data" title="Permalink"></a></h2><p>The data to be loaded is specified in yaml config files. There are two  possibilities how to organize these config files: either we use one or more  ESMValTool recipes that we had used to preprocess the data or we write a new  yaml file, independently of the ESMValTool recipes.</p><h3 id="Configuration-with-ESMValTool-recipes"><a class="docs-heading-anchor" href="#Configuration-with-ESMValTool-recipes">Configuration with ESMValTool recipes</a><a id="Configuration-with-ESMValTool-recipes-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration-with-ESMValTool-recipes" title="Permalink"></a></h3><p>We use the completely spelled out versions of the recipes that ESMValTool returns (RECIPENAME_filled.yml, stored in run-directory).</p><pre><code class="language-julia hljs">import ModelWeights as mw

# set path_data to directory where your preprocessed data is stored
path_data = &quot;/albedo/work/projects/p_forclima/preproc_data_esmvaltool/LGM&quot;;
# set path_recipes: directory where the ESMValTool recipes are stored 
path_recipes = &quot;/albedo/work/projects/p_forclima/preproc_data_esmvaltool/configs-ModelWeights/esmvaltool-recipes/lgm-cmip5-cmip6&quot;;

lgm_data = mw.loadDataFromESMValToolRecipes(
    path_data, path_recipes;
    dir_per_var = true, # default: true
    is_model_data = true, # default: true
    subset = nothing, # default: nothing
    preview = false # default: false; if true meta data for data to be loaded is returned
);</code></pre><p>The loaded data is a Dictionary mapping from an identifier of the form &#39;variable_diagnostic_alias&#39; (e.g., tas_CLIM_lgm) to a <code>YAXArray</code>. Additional metadata that was added by us is part of the YAXArrays .properties dictionary. All such fields start with an underscore, e.g. &#39;_id&#39;, &#39;_paths&#39;, &#39;_statistic&#39;.</p><p>Not all information in the ESMValTool recipes is required to specify the data to be loaded here. For a minimal example of the required structure, see <a href="https://github.com/awi-esc/ModelWeights/blob/main/configs/examples/esmvaltool-recipes/mwe_esmvaltool_config.yml">this example</a>.</p><!-- TODO: explain dir_per_var argument --><p>How the loaded data can be constrained by the subset argument of the function <code>loadDataFromESMValToolRecipes</code> is described further below. </p><h3 id="Configuration-with-seperate-yaml-file"><a class="docs-heading-anchor" href="#Configuration-with-seperate-yaml-file">Configuration with seperate yaml file</a><a id="Configuration-with-seperate-yaml-file-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration-with-seperate-yaml-file" title="Permalink"></a></h3><p>For an example of a single yaml configuration file <a href="https://github.com/awi-esc/ModelWeights/blob/main/configs/examples/example-lgm-historical.yml">see this example</a>.</p><p>Keys expected in the config-yaml file:</p><ul><li><code>path_data</code>: base path to where the preprocessed data is stored. This path will be concatenated with the directories specified for each dataset. It can </li></ul><p>be omitted if inside datasets (see below), <code>base_dir</code> refers to the entire absolute path.</p><ul><li><p><code>datasets</code>: list of each dataset to be loaded. Each dataset is specified by a dictionary with the following keys:</p><ul><li><code>base_dir::String</code>: relative path to the data with respect to the path given in <code>path_data</code>. If <code>path_data</code> is not specified in the config file, <code>path_data</code> for this dataset is assumed to refer to an absolute path instead.</li><li><code>exp::String</code>: e.g., &quot;historical&quot;</li><li><code>variables::Vector{String}</code>: e.g., [&quot;tos&quot;, &quot;tas&quot;]</li><li><code>statistics::Vector{String}</code>: may be empty for fixed variables for which no statistics are computed. In that case, <code>statistics</code> is set to [&quot;none&quot;] and a warning is thrown unless for known fixed variables (for now just [<code>orog</code>]).</li></ul><p>The following keys are optional:</p><ul><li><code>subdirs</code>: vector of strings; only subdirectories that contain any of the given strings in their name will be considered.</li><li><code>timeranges</code>:</li><li><code>aliases</code>:</li></ul></li></ul><pre><code class="language-yaml hljs">datasets: [
{
    base_dir: &quot;LGM&quot;, 
    exp: &quot;lgm&quot;, 
    variables: [&quot;tas&quot;, &quot;tos&quot;], 
    statistics: [&quot;CLIM&quot;], 
    subdirs: [&quot;20241114&quot;]
},
{
    base_dir: &quot;historical&quot;, # required String
    exp: &quot;historical&quot;, # required String
    variables: [&quot;tas&quot;, &quot;tos&quot;], # required Vector
    statistics: [&quot;CLIM&quot;], # required Vector
    timeranges: [&quot;full&quot;], # optional Vector
    subdirs: [&quot;20241121&quot;, &quot;20241118&quot;] # optional Vector
}
]</code></pre><ul><li><code>timerange_to_alias</code>: mapping from timerange to alias.</li></ul><pre><code class="language-yaml hljs">timerange_to_alias:
&quot;1850-1900&quot;: &quot;historical0&quot;
&quot;1951-1980&quot;: &quot;historical1&quot;</code></pre><p>For each given dataset the respective data is loaded from the <code>base_dir</code> at <code>path_data</code>. The keys <code>base_dir</code>, <code>exp</code>, <code>variables</code> and <code>statistics</code> are required to  specify the data to be loaded.  <code>timeranges</code> and <code>subdirs</code> are optional and work in the same way as when given as field of the optional argument <code>subset</code> described below.</p><p>As we&#39;ll explain next, you can also provide further constraints when loading the data using the function <code>loadDataFromYAML</code>. Note that in this case, the values from the provided function argument (subset::Constraint) to filter the data take precedence over what had been specified in the yaml file. </p><h3 id="Optional-parameters-for-filtering-data"><a class="docs-heading-anchor" href="#Optional-parameters-for-filtering-data">Optional parameters for filtering data</a><a id="Optional-parameters-for-filtering-data-1"></a><a class="docs-heading-anchor-permalink" href="#Optional-parameters-for-filtering-data" title="Permalink"></a></h3><p>For both functions, <code>loadDataFromESMValToolRecipes</code> and <code>loadDataFromYAML</code>, there is a set of optional parameters in order to constrain the loaded data:</p><ul><li><p><code>preview</code>: If set to false (default), the data will not be loaded and only the metadata with the information that we added that specifies which data will be loaded is returned.</p></li><li><p><code>dir_per_var</code>: If set to true (default), only subdirectories of the base_path that contain <code>_VARIABLE</code> in their name will be searched. </p></li><li><p><code>is_model_data</code>: is set to true (default) when loading CMIP data, to false when loading observationa/reanalysis data (e.g. ERA5).</p></li></ul><!-- `subset_shared`: Can be either `nothing` (default), `ModelWeights.MODEL` or `ModelWeights.MEMBER`. If set to `MODEL`, only data from the same models will be loaded. If, for instance, data from lgm and historical experiments shall be loaded, this configuration will ensure that for both, only the same models are loaded, i.e. those for which both experiments were done. While this considers models, not specific simulations, setting subset\_shared to `MEMBER` would only load models that share the exact same simulations (i.e. the same member\_id abbreviation, e.g. `r1i1p1f1`). --><ul><li><p><code>subset</code> is an optional parameter of type <code>Constraint</code> or <code>Nothing</code>. A Constraint further constrains the data to be loaded and has the following fields:</p><ul><li><code>variables</code>: The short name of the climate variable, e.g. [&quot;tas&quot;, &quot;tos&quot;].</li></ul><ul><li><code>statistics</code>: The statistic/diagnostic that was used when preprocessing the data. The names are generally arbitrary, but need to be identical to those you used in the preprocessing; for instance, we refer to the climatological average as &quot;CLIM&quot;, s.t. an example value for this argument is [&quot;CLIM&quot;].</li></ul><ul><li><code>aliases</code>: Like for <code>statistics</code>, the names are arbitrary but must be identical to what you used when preprocessing the data; e.g. [&quot;historical&quot;, &quot;historical1&quot;].</li></ul><p>An alias should refer to a certain <code>timerange</code> of a certain experiment, e.g. we call the time period from 1951-1980 &#39;historical1&#39;. To load only this data, it thus does not matter whether you set <code>timerange=[&quot;1951-1980&quot;]</code> or <code>alias=[&quot;historical1&quot;]</code>.</p><ul><li><p><code>timeranges</code>: Timeranges to be loaded; especially for historical data, you may preprocess data for different timeranges,  e.g. [&quot;full&quot;, &quot;1980-2014&quot;]. </p></li><li><p><code>projects</code>:  e.g. [&quot;CMIP5&quot;, &quot;CMIP6&quot;]. All filenames of the data to be loaded must contain at least one of the given strings. If not specified and <code>is_model_data=true</code>, it is set to [&quot;CMIP&quot;]. If not specified and <code>is_model_data=false</code>, it is set to [&quot;ERA5&quot;], the default observational dataset used.</p></li><li><p><code>models</code>: List of models or individual model members, e.g. [&quot;AWI-CM-1-1-MR&quot;]. All filenames must contain at least one of the given strings + &quot;_&quot;. The underscore is important since some models have names that are substrings of other models, e.g. &quot;CNRM-CM5&quot; and &quot;CNRM-CM5-C2&quot;. </p></li></ul><ul><li><code>subdirs</code>: If given, data will be loaded only from subdirectories of the given base_dir that contain any of the provided values in their name. This is recommended when there are many subdirectories for a specific variable  within base_dir and you only want data from a specific one (e.g. of a certain date, given that the date is included in the name of the directory).</li></ul></li></ul><h2 id="How-to-compute-weights"><a class="docs-heading-anchor" href="#How-to-compute-weights">How to compute weights</a><a id="How-to-compute-weights-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-compute-weights" title="Permalink"></a></h2><p>For a full example, see <code>scripts/run-climwip-simplified.yml</code>.</p><p>Calling <code>mw.computeWeights(dists_indep, dists_perform, config)</code> will compute weights based on the distances for the independence weights and the distances for the performance weights. The config parameter is of type <code>ConfigWeights</code> defined in <code>src/data-utils.jl</code>. It holds information about the contribution of each combination of statistic/diagnostic and climate variable, once for computing independence weights and once for computing performance weights. Further parameters concerning the weighting are specified in the ConfigWeights struct, such as the hyperparameters,  <code>sigma_performance</code> and <code>sigma_independence</code>. </p><pre><code class="nohighlight hljs">The output of the function `computeWeights` is an object of type `Weights` (see `src/data-utils.jl`) which contains the independence and performance weights seperately as well as the overall weights (`wI`, `wP` and `w`), each of which respectively sum up to 1. Further it contains the following data:
- For all combinations of statistics/diagnostics and climate variables, the distances used for computing performance as well as independence weights (`performance_distances`, `independence_distances`). 
- For every model, the generalized distances for performance (`Di`) and independence (`Sij`), (distances summed across statistics/diagnostics + variables).
- Model weights on the basis of members, i.e. the weight for every model is distributed evenly across its members, so this gives one weight per member.
- the configuration in form of the `ConfigWeights` object used to compute the weights.

</code></pre><p>@raw html &lt;!– <code>weights_variables:</code>: For each of &#39;performance&#39; and &#39;independence&#39; one value per climate variable considered. These values represent the weight of how much each climate variable influences the generalized distance of a model, which is computed by taking a weighted average across the distances with respect to different variables. Should sum up to 1.  –&gt; ```</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../requirements/">« Requirements</a><a class="docs-footer-nextpage" href="../weights/">Computing weights »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Thursday 22 May 2025 12:38">Thursday 22 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
