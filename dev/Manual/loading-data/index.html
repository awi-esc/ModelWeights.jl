<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Loading data · ModelWeights.jl</title><meta name="title" content="Loading data · ModelWeights.jl"/><meta property="og:title" content="Loading data · ModelWeights.jl"/><meta property="twitter:title" content="Loading data · ModelWeights.jl"/><meta name="description" content="Documentation for ModelWeights.jl."/><meta property="og:description" content="Documentation for ModelWeights.jl."/><meta property="twitter:description" content="Documentation for ModelWeights.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelWeights.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelWeights.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting-started/">Getting started</a></li><li><a class="tocitem" href="../../weights/">Model weights</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Loading data</a><ul class="internal"><li><a class="tocitem" href="#Load-several-datasets-into-a-DataMap"><span>Load several datasets into a DataMap</span></a></li><li><a class="tocitem" href="#Loading-a-single-dataset-into-a-YAXArray"><span>Loading a single dataset into a YAXArray</span></a></li></ul></li><li><a class="tocitem" href="../filtering-data/">Filtering data</a></li><li><a class="tocitem" href="../computing-weights/">Computing weights</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/API/">Public API</a></li><li><a class="tocitem" href="../../reference/references/">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Loading data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Loading data</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/awi-esc/ModelWeights.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/awi-esc/ModelWeights.jl/blob/main/docs/src/Manual/loading-data.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Loading-data"><a class="docs-heading-anchor" href="#Loading-data">Loading data</a><a id="Loading-data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-data" title="Permalink"></a></h1><p>The basic representation of data is in form of a dictionary that simply maps from ids  (Strings) to the data itself stored as <a href="https://juliadatacubes.github.io/YAXArrays.jl/v0.6.1/">YAXArrays</a>. We name this type alias a <code>DataMap</code>. </p><h2 id="Load-several-datasets-into-a-DataMap"><a class="docs-heading-anchor" href="#Load-several-datasets-into-a-DataMap">Load several datasets into a DataMap</a><a id="Load-several-datasets-into-a-DataMap-1"></a><a class="docs-heading-anchor-permalink" href="#Load-several-datasets-into-a-DataMap" title="Permalink"></a></h2><p>Data is loaded with the function <code>defineDataMap</code>. It defines several methods that we explain further below. </p><p>The <code>defineDataMap</code> methods provide a set of default keyword arguments: </p><ul><li><p><code>preview::Bool = false</code>: set to true if instead of loading the data, a list of paths to the data that would be loaded with the given paths and constraints, is returned.</p></li><li><p><code>sorted::Bool = true</code>: set to false, if the loaded data should not be sorted alphabetically according to the model dimension.</p></li></ul><p>The most important two arguments are <code>filename_format</code> and <code>dtype</code> which we will explain in turn next:</p><h3 id="Filename-format"><a class="docs-heading-anchor" href="#Filename-format">Filename format</a><a id="Filename-format-1"></a><a class="docs-heading-anchor-permalink" href="#Filename-format" title="Permalink"></a></h3><ul><li><code>filename_format::Union{Symbol, String}</code>: This argument is important since the data is loaded based on the information retrieved from the filenames of the data.</li></ul><p>There are three predefined filename formats:</p><ul><li><code>VARIABLE_TABLEID_MODEL_EXPERIMENT_VARIANT_GRID_TIMERANGE</code> (:cmip), default value</li><li><code>MIP_MODEL_TABLEID_EXPERIMENT_VARIANT_VARIABLE</code> (:esmvaltool_cmip5)</li><li><code>MIP_MODEL_TABLEID_EXPERIMENT_VARIANT_VARIABLE_GRID</code> (:esmvaltool_cmip6)</li></ul><p>It is also possible to use the format <code>:esmvaltool</code> so that for every file it is automatically derived based on the fileformat whether it corresponds to CMIP5 or CMIP6.</p><p>Further, it is possible to specify your own filename format. TODO</p><h3 id="Data-Type-(dtype)"><a class="docs-heading-anchor" href="#Data-Type-(dtype)">Data Type (dtype)</a><a id="Data-Type-(dtype)-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Type-(dtype)" title="Permalink"></a></h3><ul><li><code>dtype::String = &quot;cmip&quot;</code></li></ul><p>For now, the keyword argument <code>dtype</code> is just used to provide specific meta data when <code>dtype=&quot;cmip&quot;</code>. This argument should be specified when <em>not</em> working with CMIP data (including observational data), since cmip is the default value.</p><h3 id="Metadata"><a class="docs-heading-anchor" href="#Metadata">Metadata</a><a id="Metadata-1"></a><a class="docs-heading-anchor-permalink" href="#Metadata" title="Permalink"></a></h3><p>The metadata of each dataset (the <code>.properties</code> Dictionary of each YAXArray in a DataMap) contains the metadata loaded from the original files as well as additional information if it is provided in the optional keyword argument <code>meta_data</code> of function <code>defineDataMap</code> (a dictionary with keys of type String).</p><h3 id="Loading-data-from-directories"><a class="docs-heading-anchor" href="#Loading-data-from-directories">Loading data from directories</a><a id="Loading-data-from-directories-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-data-from-directories" title="Permalink"></a></h3><p>The datasets loaded in a DataMap all refer to a single variable and experiment, i.e. the  YAXArrays have the dimensions of the grid the data is defined on, e.g., (<code>lon</code>, <code>lat</code>) or,  for 3D data, (<code>lon</code>, <code>lat</code>, <code>depth</code>).</p><p>To load data for different datasets, e.g. variable tos for lgm and historical experiment:</p><pre><code class="language-julia hljs">using ModelWeights
paths_datasets = [&quot;path/to/lgm/tos&quot;, &quot;path/to/historical/tos&quot;]
ids_datasets = [&quot;lgm-tos&quot;, &quot;historical-tos&quot;]
defineDataMap(paths_datasets, ids_datasets; dtype = &quot;cmip&quot;)</code></pre><p>You might have several directories from where you want to load data for a single dataset, e.g. when you store CMIP5 and CMIP6 data at different locations. <code>defineDataMap</code> also accepts Vectors of Vectors, e.g.:</p><pre><code class="language-julia hljs">paths_datasets = [
    [&quot;path/to/cmip5/lgm/tos&quot;, &quot;path/to/cmip6/lgm/tos&quot;], 
    [&quot;path/to/cmip5/historical/tos&quot;, &quot;path/to/cmip6/historical/tos&quot;]
]
ids_datasets = [&quot;lgm-tos&quot;, &quot;historical-tos&quot;]
defineDataMap(paths_datasets, ids_datasets; dtype = &quot;cmip&quot;)</code></pre><p>If you just want to load a single dataset, Vectors aren&#39;t needed, e.g.:</p><pre><code class="language-julia hljs">defineDataMap(&quot;path/to/lgm/tos&quot;, &quot;lgm-tos&quot;; dtype = &quot;cmip&quot;)</code></pre><h3 id="Loading-data-preprocessed-with-ESMValTool"><a class="docs-heading-anchor" href="#Loading-data-preprocessed-with-ESMValTool">Loading data preprocessed with ESMValTool</a><a id="Loading-data-preprocessed-with-ESMValTool-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-data-preprocessed-with-ESMValTool" title="Permalink"></a></h3><h4 id="loading-data-recipes"><a class="docs-heading-anchor" href="#loading-data-recipes">Based on recipes</a><a id="loading-data-recipes-1"></a><a class="docs-heading-anchor-permalink" href="#loading-data-recipes" title="Permalink"></a></h4><p>If you use ESMValTool to preprocess data, you can use the recipes for preprocessing the data as config files to load the or some of the data into a ModelWeights.DataMap. The first argument points to the top-level directory where the data is stored, namely the same that was used in ESMValTool as base data directory. The second argument points to a directory that contains one or more recipes, namely the filled out versions of the recipes that are generated by ESMValTool, to be found in the run-directory. These have the same name as the recipe itself concatenated with _filled in the end.</p><p>To ensure that the first two arguments are correctly interpreted, the third argument must be set to <code>:esmvaltool_recipes</code>. In this case, the default value for <code>filename_format</code> is set to :esmvaltool (instead of :cmip). </p><pre><code class="language-julia hljs">defineDataMap(&quot;path/to/base/data/dir&quot;, &quot;path/to/recipes/dir&quot;, :esmvaltool_recipes; dtype = &quot;cmip&quot;)</code></pre><h4 id="loading-data-config"><a class="docs-heading-anchor" href="#loading-data-config">Based on config files</a><a id="loading-data-config-1"></a><a class="docs-heading-anchor-permalink" href="#loading-data-config" title="Permalink"></a></h4><p>If the data was preprocessed with ESMValTool, it is also possible to specify a config yaml file with the required values. Here is an example that loads tas and tos data for the experiments lgm, historical and piControl: </p><pre><code class="language-yaml hljs">base_path_data: &quot;/path/to/dir/with/preprocessed/data&quot;

datasets: [
  {
    base_dir: &quot;LGM&quot;, 
    exp: &quot;lgm&quot;, 
    variables: [&quot;tas&quot;, &quot;tos&quot;],
    aliases: [&quot;lgm&quot;],
    statistics: [&quot;CLIM&quot;], 
    subset: {
      base_subdirs: [&quot;20241114&quot;]
    }
  },
  {
    base_dir: &quot;piControl&quot;, 
    exp: &quot;piControl&quot;, 
    variables: [&quot;tas&quot;, &quot;tos&quot;],
    aliases: [&quot;piControl&quot;],  
    statistics: [&quot;CLIM&quot;],
    subset: {
      base_subdirs: [&quot;lgm_models&quot;, &quot;20250322&quot;]
    }
  },
    {
    base_dir: &quot;historical&quot;, 
    exp: &quot;historical&quot;, 
    variables: [&quot;tas&quot;, &quot;tos&quot;],
    aliases: [&quot;historical&quot;], 
    statistics: [&quot;CLIM&quot;]
  }
]</code></pre><p>TODO: update the following expected keys</p><p>Keys expected in the config-yaml file:</p><ul><li><code>path_data</code>: base path to where the preprocessed data is stored. This path will be concatenated with the directories specified for each dataset. It can </li></ul><p>be omitted if inside datasets (see below), <code>base_dir</code> refers to the entire absolute path.</p><ul><li><p><code>datasets</code>: list of each dataset to be loaded. Each dataset is specified by a dictionary with the following keys:</p><ul><li><code>base_dir::String</code>: relative path to the data with respect to the path given in <code>path_data</code>. If <code>path_data</code> is not specified in the config file, <code>path_data</code> for this dataset is assumed to refer to an absolute path instead.</li><li><code>exp::String</code>: e.g., &quot;historical&quot;</li><li><code>variables::Vector{String}</code>: e.g., [&quot;tos&quot;, &quot;tas&quot;]</li><li><code>statistics::Vector{String}</code>: may be empty for fixed variables for which no statistics are computed. In that case, <code>statistics</code> is set to [&quot;none&quot;] and a warning is thrown unless for known fixed variables (for now just [<code>orog</code>]).</li></ul><p>The following keys are optional:</p><ul><li><code>subdirs</code>: vector of strings; only subdirectories that contain any of the given strings in their name will be considered.</li><li><code>timeranges</code>:</li><li><code>aliases</code>:</li></ul></li></ul><p>When the data was preprocessed with ESMValTool, the structure of the directories where the data is stored looks as follows. Uppercase names refer to variables, lowercase names mean that the names can be arbitrary unless stated differently in the comments to the right. </p><pre><code class="language-bash hljs">├── BASE_DIR # arbitrary (ESMValTool recipe name + _ + YYYYMMDD_HHMMSS)
│       └── preproc # this directory must be called &#39;preproc&#39;
│       │      └── ALIAS # arbitrary (name of the diagnostic used in the ESMValTool recipe, chosen by the user)
│       │      │       └── VAR_STATISTIC # name of entry among `variables` in the ESMValTool recipe e.g. tos_CLIM (chosen by the user)
│       │      │            └── model1.nc
│       │      │            └── model2.nc
│       │      │            └── ...
│       │      │       └── VAR_STATISTIC
│       │      │            └── ...
│       │      └── ALIAS # arbitrary (name of the diagnostic used in the ESMValTool recipe, chosen by the user)
│       │      │       └── VAR_STATISTIC # name of entry among `variables` in the ESMValTool recipe e.g. tos_CLIM (chosen by the user)
│       │      │            └── model1.nc
│       │      │            └── model2.nc
│       │      │            └── ...
│       │      │       └── VAR_STATISTIC
│       │      │            └── ...
│       └── other output from ESMValTool
....</code></pre><p><code>BASE_DIR</code> is the name of the recipe plus the date and time using the format YYYYMMDD<em>HHMMSS. <code>ALIAS</code> corresponds to the name (chosen by the user) of the diagnostics defined in the recipe. `VAR</em>STATISTIC<code>refers to the name of the entries among the</code>variables` section in the ESMValTool recipe. We set these names to the short name of the variable (e.g. &#39;tas&#39;) and the applied statistic (e.g. &#39;CLIM&#39;),  concatenated by an underscore (e.g, tas<em>CLIM). Any name can be chosen here; but when using VAR</em>STAT, the data can be subset to certain statistics only (see TODO).</p><p>If there is one subdirectory for each climate variable (this is, for instance, the case when one ESMValTool recipe is used for a single variable), the structure of the data is nearly the same. The only difference is that the upper most directory, BASE<em>DIR, has subdirectories which then point to the directory called &#39;preproc&#39;. The name of the subdirectories (<code>subdir1</code>, <code>subdir2</code>) is the name of the recipe concatenated with the timestamp in the format YYYYMMDD</em>HHMMSS by an underscore. Note that here, we assume one subdirectory per climate variable, and thus the name of each of the subdirectories is assumened to contain <em>VAR</em>, e.g. (BASE<em>DIR/recipe</em>tas<em>lgm or BASE</em>DIR/recipe<em>tos</em>lgm).</p><pre><code class="language-bash hljs">├── BASE_DIR
│   └── subdir1  # name must contain &quot;_VAR_&quot; where VAR is the short_name of the variable, e.g. _tos_
│   └── subdir2  # name must contain &quot;_VAR_&quot; where VAR is the short_name of the variable, e.g. _tos_
│       └── preproc # this directory must be called &#39;preproc&#39;
│       │      └── ALIAS # the name of the diagnostic in the ESMValTool recipe
│       │      │       └── VAR_STATISTIC  # can be any name, but this schema useful for subsetting easily wrt statistics
│       │      │            └── model1.nc
│       │      │            └── model2.nc
│       │      │            └── ...
│       │      │       └── VAR_STATISTIC
│       │      │            └── ...
│       │      └── ALIAS # the name of the diagnostic in the ESMValTool recipe
│       │      │       └── VAR_STATISTIC  # can be any name, but this schema useful for subsetting easily wrt statistics
│       │      │            └── model1.nc
│       │      │            └── model2.nc
│       │      │            └── ...
│       │      │       └── VAR_STATISTIC
│       │      │            └── ...
│       └── possibly other output from ESMValTool
....</code></pre><h2 id="Loading-a-single-dataset-into-a-YAXArray"><a class="docs-heading-anchor" href="#Loading-a-single-dataset-into-a-YAXArray">Loading a single dataset into a YAXArray</a><a id="Loading-a-single-dataset-into-a-YAXArray-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-a-single-dataset-into-a-YAXArray" title="Permalink"></a></h2><p>The function that all <code>defineDataMap</code> functions eventually calls is <code>loadPreprocData</code>.  It can be used to directly load data into a YAXArray. It accepts a vector paths to netcdf files and the filename format (and some optional  keyword arguments, like <code>dtype</code>).</p><pre><code class="language-julia hljs">paths = [
    &quot;path/to/data/dir/CMIP6_AWI-ESM-1-1-LR_Amon_lgm_r1i1p1f1_tas_gn.nc&quot;, 
    &quot;path/to/data/dir/CMIP6_CESM2-FV2_Amon_lgm_r1i2p2f1_tas_gn.nc&quot;
]
filename_format = &quot;MIP_MODEL_TABLEID_EXPERIMENT_VARIANT_VARIABLE_GRID&quot;
v1 = loadPreprocData(paths, filename_format; dtype = &quot;cmip&quot;)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../weights/">« Model weights</a><a class="docs-footer-nextpage" href="../filtering-data/">Filtering data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 17 September 2025 15:04">Wednesday 17 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
